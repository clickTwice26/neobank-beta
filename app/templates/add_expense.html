{% extends "base.html" %}

{% block title %}Add Expense - Expense Tracker{% endblock %}

{% block content %}
<!-- Modern Header with Gradient -->
<div class="bg-gradient-to-br from-indigo-600 via-purple-600 to-pink-600 text-white">
    <div class="container mx-auto px-4 py-8">
        <div class="flex items-center justify-between">
            <div>
                <h1 class="text-3xl font-bold mb-2">Add New Expense</h1>
                <p class="text-indigo-100">Track your spending with ease</p>
            </div>
            <a href="{{ url_for('main.dashboard') }}" class="bg-white/10 hover:bg-white/20 p-3 rounded-full transition-all duration-300">
                <i class="fas fa-arrow-left text-xl"></i>
            </a>
        </div>
    </div>
</div>

<!-- Main Content -->
<div class="container mx-auto px-4 py-8">
    <div class="max-w-2xl mx-auto">
        
        <!-- Form Card -->
        <div class="bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden">
            <form method="POST" x-data="expenseForm()" class="divide-y divide-gray-100">
                
                <!-- Amount Section -->
                <div class="p-6">
                    <div class="text-center mb-6">
                        <label class="block text-sm font-semibold text-gray-700 mb-3">
                            <i class="fas fa-dollar-sign mr-2 text-green-500"></i>Amount
                        </label>
                        <div class="relative">
                            <span class="absolute left-1/2 top-1/2 transform -translate-x-full -translate-y-1/2 text-gray-400 text-4xl font-light">$</span>
                            <input type="number" 
                                   name="amount" 
                                   x-model="amount"
                                   @input="updatePreview"
                                   step="0.01" 
                                   min="0.01"
                                   required
                                   class="w-full text-center text-4xl font-bold text-gray-900 bg-transparent border-0 border-b-4 border-gray-200 focus:border-indigo-500 focus:ring-0 pb-4"
                                   placeholder="0.00">
                        </div>
                        <div x-show="amount" x-transition class="mt-3 text-sm text-gray-500">
                            <span x-text="formatCurrency(amount)"></span>
                        </div>
                    </div>
                </div>

                <!-- Category Section -->
                <div class="p-6">
                    <label class="block text-sm font-semibold text-gray-700 mb-4">
                        <i class="fas fa-tags mr-2 text-blue-500"></i>Select Category
                    </label>
                    <div class="grid grid-cols-2 gap-3">
                        {% for category in categories %}
                        <label class="category-card group cursor-pointer">
                            <input type="radio" 
                                   name="category_id" 
                                   value="{{ category.id }}"
                                   x-model="categoryId"
                                   @change="updatePreview"
                                   required 
                                   class="sr-only">
                            <div class="flex flex-col items-center justify-center p-4 rounded-xl border-2 border-gray-200 group-hover:border-indigo-300 group-hover:bg-indigo-50 transition-all duration-200 h-20"
                                 :class="categoryId == '{{ category.id }}' ? 'border-indigo-500 bg-indigo-50 ring-2 ring-indigo-200' : ''">
                                <i class="{{ category.icon }} text-xl mb-1 text-gray-600"></i>
                                <span class="text-xs font-medium text-gray-600 text-center">{{ category.name }}</span>
                            </div>
                        </label>
                        {% endfor %}
                    </div>
                </div>

                <!-- Description Section -->
                <div class="p-6">
                    <label for="description" class="block text-sm font-semibold text-gray-700 mb-3">
                        <i class="fas fa-comment mr-2 text-purple-500"></i>Description
                    </label>
                    <textarea name="description" 
                              id="description"
                              x-model="description"
                              rows="3"
                              class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-200 resize-none"
                              placeholder="What did you spend on?"></textarea>
                </div>

                <!-- Date Section -->
                <div class="p-6">
                    <label for="date" class="block text-sm font-semibold text-gray-700 mb-3">
                        <i class="fas fa-calendar mr-2 text-orange-500"></i>Date
                    </label>
                    <input type="date" 
                           name="date" 
                           id="date"
                           value="{{ today }}"
                           required
                           class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-200">
                </div>

                <!-- Action Buttons -->
                <div class="p-6 bg-gray-50">
                    <div class="flex space-x-4">
                        <button type="submit" 
                                class="flex-1 bg-gradient-to-r from-indigo-600 to-purple-600 text-white py-3 px-6 rounded-xl font-semibold hover:from-indigo-700 hover:to-purple-700 transform hover:scale-[1.02] transition-all duration-200 shadow-lg hover:shadow-xl">
                            <i class="fas fa-plus mr-2"></i>Add Expense
                        </button>
                        <a href="{{ url_for('main.dashboard') }}" 
                           class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 py-3 px-6 rounded-xl font-semibold text-center transition-all duration-200">
                            Cancel
                        </a>
                    </div>
                </div>

            </form>
        </div>

        <!-- Preview Card -->
        <div x-show="showPreview" 
             x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0 transform translate-y-4"
             x-transition:enter-end="opacity-100 transform translate-y-0"
             class="mt-6 bg-gradient-to-r from-green-500 to-teal-500 text-white rounded-2xl p-6 shadow-lg">
            <h3 class="font-semibold mb-2">Preview</h3>
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-2xl font-bold" x-text="formatCurrency(amount)"></p>
                    <p class="text-green-100" x-text="getCategoryName()"></p>
                </div>
                <div class="text-2xl" x-html="getCategoryIconHtml()"></div>
            </div>
        </div>

    </div>
</div>

<script>
function expenseForm() {
    return {
        amount: '',
        categoryId: '',
        description: '',
        showPreview: false,
        categories: {{ categories|tojson }},
        
        updatePreview() {
            this.showPreview = this.amount > 0 && this.categoryId;
        },
        
        formatCurrency(amount) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD'
            }).format(amount || 0);
        },
        
        getCategoryName() {
            const category = this.categories.find(c => c.id == this.categoryId);
            return category ? category.name : '';
        },
        
        getCategoryIcon() {
            const category = this.categories.find(c => c.id == this.categoryId);
            return category ? category.icon : '';
        },
        
        getCategoryIconHtml() {
            const category = this.categories.find(c => c.id == this.categoryId);
            return category ? `<i class="${category.icon}"></i>` : '';
        }
    }
}
</script>

<style>
.category-card input:checked + div {
    @apply border-indigo-500 bg-indigo-50 ring-2 ring-indigo-200;
}
</style>
{% endblock %}