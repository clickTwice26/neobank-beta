{% extends "base.html" %}

{% block title %}Dashboard - ExpenseTracker{% endblock %}

{% block content %}
<!-- Main Dashboard Container -->
<div class="container mx-auto px-4 py-6 max-w-md">
    
    <!-- Wallet Balance Card -->
    <div class="gradient-purple rounded-3xl p-6 mb-6 text-white relative overflow-hidden">
        <div class="relative z-10">
            <div class="flex items-center justify-between mb-2">
                <span class="text-sm text-white/80 font-medium">Total Remaining Budget</span>
                <i class="fas fa-wallet text-white/60"></i>
            </div>
            <div class="mb-4">
                <h2 class="text-3xl font-bold mb-1">${{ "%.2f"|format(monthly_total or 0) }}</h2>
                <span class="text-sm text-white/70">Current Month</span>
            </div>
            <div class="flex items-center space-x-4">
                <div class="status-badge" style="background: rgba(34, 197, 94, 0.2); color: #22c55e;">
                    <i class="fas fa-arrow-up text-xs mr-1"></i>
                    On Track
                </div>
                <span class="text-xs text-white/60">Your best spending limit on track</span>
            </div>
        </div>
        <!-- Background decoration -->
        <div class="absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -mr-16 -mt-16"></div>
        <div class="absolute bottom-0 left-0 w-24 h-24 bg-white/5 rounded-full -ml-12 -mb-12"></div>
    </div>

    <!-- Quick Stats Grid -->
    <div class="grid grid-cols-3 gap-4 mb-6">
        <div class="card text-center">
            <div class="w-12 h-12 bg-blue-100 rounded-2xl flex items-center justify-center mx-auto mb-3">
                <i class="fas fa-credit-card text-blue-600 text-lg"></i>
            </div>
            <p class="text-2xl font-bold text-gray-900">${{ "%.0f"|format(monthly_total or 0) }}</p>
            <p class="text-xs text-gray-500 font-medium">Current Balance</p>
        </div>
        
        <div class="card text-center">
            <div class="w-12 h-12 bg-purple-100 rounded-2xl flex items-center justify-center mx-auto mb-3">
                <i class="fas fa-chart-line text-purple-600 text-lg"></i>
            </div>
            <p class="text-2xl font-bold text-gray-900">{{ recent_expenses|length }}</p>
            <p class="text-xs text-gray-500 font-medium">Transactions</p>
        </div>
        
        <div class="card text-center">
            <div class="w-12 h-12 bg-green-100 rounded-2xl flex items-center justify-center mx-auto mb-3">
                <i class="fas fa-piggy-bank text-green-600 text-lg"></i>
            </div>
            <p class="text-2xl font-bold text-gray-900">${{ "%.0f"|format((5000 - (monthly_total or 0))) }}</p>
            <p class="text-xs text-gray-500 font-medium">Saved</p>
        </div>
    </div>

    <!-- Expense/Income Toggle -->
    <div class="flex bg-gray-100 rounded-2xl p-1 mb-6">
        <button class="flex-1 py-3 px-4 rounded-xl bg-purple-600 text-white font-medium text-sm transition-all">
            Expense
        </button>
        <button class="flex-1 py-3 px-4 rounded-xl text-gray-600 font-medium text-sm hover:bg-gray-200 transition-all">
            Income
        </button>
    </div>

    <!-- Top Spending Categories -->
    <div class="card mb-6">
        <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-bold text-gray-900">Top Spending</h3>
            <a href="{{ url_for('expenses.categories') }}" class="text-purple-600 text-sm font-medium">View All</a>
        </div>
        
        <div class="grid grid-cols-5 gap-3 mb-4">
            {% for category in category_stats[:5] %}
            <div class="text-center">
                <div class="category-icon mx-auto mb-2" style="background-color: {{ category.color }}20;">
                    <i class="{{ category.icon }}" style="color: {{ category.color }}"></i>
                </div>
                <p class="text-xs text-gray-600 font-medium">{{ category.name[:6] }}</p>
            </div>
            {% else %}
            <div class="col-span-5 text-center py-4">
                <i class="fas fa-tags text-gray-300 text-2xl mb-2"></i>
                <p class="text-sm text-gray-500">No categories yet</p>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Monthly Budget Progress -->
    <div class="card mb-6">
        <h3 class="text-lg font-bold text-gray-900 mb-4">Monthly Budget</h3>
        
        {% for category in category_stats[:3] %}
        <div class="flex items-center justify-between mb-4 last:mb-0">
            <div class="flex items-center space-x-3">
                <div class="category-icon" style="background-color: {{ category.color }}20;">
                    <i class="{{ category.icon }} text-sm" style="color: {{ category.color }}"></i>
                </div>
                <div>
                    <p class="font-semibold text-gray-900 text-sm">{{ category.name }}</p>
                    <p class="text-xs text-gray-500">${{ "%.0f"|format(category.total) }} Per day</p>
                </div>
            </div>
            <div class="text-right">
                <p class="font-bold text-gray-900 text-sm">${{ "%.0f"|format(category.total) }}</p>
                <div class="w-20 progress-bar mt-1">
                    <div class="progress-fill" style="width: {{ (category.total / 1000 * 100) if category.total else 0 }}%; background: {{ category.color }};"></div>
                </div>
            </div>
        </div>
        {% else %}
        <div class="text-center py-4">
            <i class="fas fa-chart-bar text-gray-300 text-2xl mb-2"></i>
            <p class="text-sm text-gray-500">No expenses yet</p>
        </div>
        {% endfor %}
    </div>

    <!-- Recent Transactions -->
    <div class="card">
        <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-bold text-gray-900">Transactions List</h3>
            <a href="{{ url_for('expenses.list_expenses') }}" class="text-purple-600 text-sm font-medium">Weekly</a>
        </div>
        
        <div class="space-y-3">
            {% for expense in recent_expenses[:5] %}
            <div class="flex items-center justify-between py-3 border-b border-gray-50 last:border-0">
                <div class="flex items-center space-x-3">
                    <div class="category-icon" style="background-color: {{ expense.category.color }}20;">
                        <i class="{{ expense.category.icon }} text-sm" style="color: {{ expense.category.color }}"></i>
                    </div>
                    <div>
                        <p class="font-semibold text-gray-900 text-sm">{{ expense.category.name }}</p>
                        <p class="text-xs text-gray-500">{{ expense.date.strftime('%d %b, %Y') }}</p>
                    </div>
                </div>
                <div class="text-right">
                    <p class="font-bold text-gray-900 text-sm">${{ "%.2f"|format(expense.amount) }}</p>
                    {% if expense.description %}
                    <p class="text-xs text-gray-500">{{ expense.description[:15] }}...</p>
                    {% endif %}
                </div>
            </div>
            {% else %}
            <div class="text-center py-6">
                <i class="fas fa-receipt text-gray-300 text-3xl mb-3"></i>
                <p class="text-gray-500 font-medium">No transactions yet</p>
                <p class="text-sm text-gray-400 mb-4">Start tracking your expenses</p>
                <a href="{{ url_for('expenses.add_expense') }}" class="btn-primary inline-block">
                    <i class="fas fa-plus mr-2"></i>Add Expense
                </a>
            </div>
            {% endfor %}
        </div>
    </div>

</div>

<!-- Floating Action Button for Quick Add -->
{% if recent_expenses %}
<div class="fixed bottom-24 right-4 z-30">
    <a href="{{ url_for('expenses.add_expense') }}" class="w-14 h-14 gradient-purple rounded-full flex items-center justify-center text-white shadow-2xl hover:shadow-purple-500/25 transition-all">
        <i class="fas fa-plus text-lg"></i>
    </a>
</div>
{% endif %}

<script>
// Chart data for monthly expenses (placeholder for future Chart.js implementation)
const monthlyData = {{ monthly_chart_data|tojson if monthly_chart_data else '[]' }};

// Add smooth animations
document.addEventListener('DOMContentLoaded', function() {
    // Animate cards on load
    const cards = document.querySelectorAll('.card');
    cards.forEach((card, index) => {
        card.style.animationDelay = `${index * 0.1}s`;
        card.classList.add('fade-in');
    });
    
    // Animate progress bars
    const progressBars = document.querySelectorAll('.progress-fill');
    progressBars.forEach(bar => {
        const width = bar.style.width;
        bar.style.width = '0%';
        setTimeout(() => {
            bar.style.width = width;
        }, 500);
    });
});
</script>

<style>
/* Additional dashboard-specific styles */
.gradient-purple {
    background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 50%, #6d28d9 100%);
}

/* Smooth card animations */
.card {
    opacity: 0;
    animation: slideUp 0.6s ease forwards;
}

@keyframes slideUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Enhanced category icons */
.category-icon {
    transition: all 0.3s ease;
}

.category-icon:hover {
    transform: scale(1.1);
}

/* Custom progress bar animations */
.progress-fill {
    background: linear-gradient(90deg, currentColor 0%, currentColor 100%);
    transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
}
</style>
{% endblock %}