{% extends "base.html" %}

{% block title %}Dashboard - Expense Tracker{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50 p-4 pb-24">
    <!-- Header Section -->
    <div class="flex justify-between items-center mb-8">
        <div>
            <h1 class="text-2xl font-bold text-gray-900">{{ current_month }}</h1>
            <p class="text-gray-500 text-sm">Track your spending</p>
        </div>
        <div class="w-10 h-10 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full flex items-center justify-center">
            <i class="fas fa-user text-white"></i>
        </div>
    </div>

    <!-- Balance Cards -->
    <div class="grid grid-cols-2 gap-4 mb-8">
        <!-- Income Card -->
        <div class="income-card card">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-white/80 text-sm font-medium">Income</p>
                    <p class="text-2xl font-bold text-white">${{ "%.0f"|format(monthly_total * 4) }}</p>
                    <p class="text-white/60 text-xs mt-1">Monthly budget</p>
                </div>
                <div class="w-8 h-8 bg-white/20 rounded-lg flex items-center justify-center">
                    <i class="fas fa-arrow-up text-white text-sm"></i>
                </div>
            </div>
        </div>

        <!-- Expenses Card -->
        <div class="spending-card card">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-white/80 text-sm font-medium">Expenses</p>
                    <p class="text-2xl font-bold text-white">${{ "%.0f"|format(monthly_total) }}</p>
                    <p class="text-white/60 text-xs mt-1">This month</p>
                </div>
                <div class="w-8 h-8 bg-white/20 rounded-lg flex items-center justify-center">
                    <i class="fas fa-arrow-down text-white text-sm"></i>
                </div>
            </div>
        </div>
    </div>

    <!-- Spending Progress -->
    <div class="card mb-8">
        <div class="flex items-center justify-between mb-6">
            <h3 class="text-lg font-semibold text-gray-900">Safe to Spend</h3>
            <span class="text-2xl font-bold text-gray-900">${{ "%.0f"|format((monthly_total * 4) - monthly_total) }}</span>
        </div>
        
        <div class="relative">
            <div class="flex items-center justify-center mb-4">
                <div class="relative w-32 h-32">
                    <svg class="w-32 h-32 progress-ring" viewBox="0 0 120 120">
                        <circle cx="60" cy="60" r="54" fill="none" stroke="#f1f5f9" stroke-width="8"/>
                        <circle 
                            cx="60" cy="60" r="54" 
                            fill="none" 
                            stroke="url(#gradient)" 
                            stroke-width="8"
                            stroke-linecap="round"
                            stroke-dasharray="339.292"
                            stroke-dashoffset="{{ 339.292 - (339.292 * (monthly_total / (monthly_total * 4) if monthly_total > 0 else 0)) }}"
                            class="progress-ring-circle">
                        </circle>
                        <defs>
                            <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#10b981;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#059669;stop-opacity:1" />
                            </linearGradient>
                        </defs>
                    </svg>
                    <div class="absolute inset-0 flex items-center justify-center">
                        <div class="text-center">
                            <p class="text-xs text-gray-500">Left to spend</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Transactions -->
    <div class="card mb-8">
        <div class="flex items-center justify-between mb-6">
            <h3 class="text-lg font-semibold text-gray-900">Recent Transactions</h3>
            <button onclick="window.location.href='{{ url_for('expenses.list_expenses') }}'" class="text-sm text-blue-600 font-medium">See all</button>
        </div>

        {% if recent_expenses %}
            <div class="space-y-4">
                {% for expense in recent_expenses %}
                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-16 hover:bg-gray-100 transition-colors">
                    <div class="flex items-center">
                        <div class="category-icon" style="background-color: {{ expense.color }}20;">
                            <span style="color: {{ expense.color }}">{{ expense.icon }}</span>
                        </div>
                        <div>
                            <h4 class="font-semibold text-gray-900 text-sm">
                                {{ expense.description or expense.category_name }}
                            </h4>
                            <p class="text-xs text-gray-500">{{ expense.date }} â€¢ {{ expense.category_name }}</p>
                        </div>
                    </div>
                    <div class="flex items-center">
                        <span class="font-bold text-gray-900">${{ "%.0f"|format(expense.amount) }}</span>
                        <button class="ml-3 text-gray-400 hover:text-red-500 transition-colors" 
                                onclick="deleteExpense({{ expense.id }})">
                            <i class="fas fa-trash text-xs"></i>
                        </button>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="text-center py-8 text-gray-500">
                <i class="fas fa-receipt text-4xl mb-4 text-gray-300"></i>
                <p class="mb-2">No transactions yet</p>
                <p class="text-sm">Start by adding your first expense!</p>
            </div>
        {% endif %}
    </div>

    <!-- Top Spend Areas -->
    <div class="card mb-8">
        <div class="flex items-center justify-between mb-6">
            <h3 class="text-lg font-semibold text-gray-900">Top Spend Areas</h3>
            <i class="fas fa-search text-gray-400"></i>
        </div>

        {% if category_totals %}
            <div class="space-y-4">
                {% for category in category_totals[:4] %}
                    {% if category.total > 0 %}
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <div class="category-icon" style="background-color: {{ category.color }}20;">
                                <i class="{{ category.icon }}" style="color: {{ category.color }}"></i>
                            </div>
                            <div>
                                <h4 class="font-semibold text-gray-900 text-sm">{{ category.name }}</h4>
                                <div class="w-24 bg-gray-200 rounded-full h-2 mt-1">
                                    {% set percentage = (category.total / monthly_total * 100) if monthly_total > 0 else 0 %}
                                    <div class="h-2 rounded-full transition-all duration-500" 
                                         style="width: {{ percentage }}%; background-color: {{ category.color }};">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <span class="font-bold text-gray-900">${{ "%.0f"|format(category.total) }}</span>
                    </div>
                    {% endif %}
                {% endfor %}
            </div>
        {% endif %}
    </div>

    <!-- Quick Add Expense Button -->
    <div class="fixed bottom-20 right-4 z-50">
        <a href="{{ url_for('expenses.add_expense') }}" 
           class="w-14 h-14 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center shadow-lg hover:shadow-xl transform hover:scale-110 transition-all duration-300">
            <i class="fas fa-plus text-white text-xl"></i>
        </a>
    </div>
</div>

<script>
function deleteExpense(expenseId) {
    if (confirm('Delete this expense?')) {
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = `/expenses/delete/${expenseId}`;
        document.body.appendChild(form);
        form.submit();
    }
}

// Initialize progress animations
document.addEventListener('DOMContentLoaded', function() {
    // Animate progress ring
    const progressRing = document.querySelector('.progress-ring-circle');
    if (progressRing) {
        setTimeout(() => {
            progressRing.style.transition = 'stroke-dashoffset 1.5s ease-in-out';
        }, 500);
    }

    // Animate category progress bars
    const progressBars = document.querySelectorAll('[style*="width:"]');
    progressBars.forEach((bar, index) => {
        const width = bar.style.width;
        bar.style.width = '0%';
        setTimeout(() => {
            bar.style.width = width;
        }, 800 + (index * 200));
    });
});
</script>
{% endblock %}