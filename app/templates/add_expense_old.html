{% extends "base.html" %}

{% block title %}Add Expense - Expense Tracker{% endblock %}

{% block content %}
<div class="p-4 max-w-2xl mx-auto">
    <!-- Header -->
    <div class="mb-6">
        <div class="flex items-center justify-between">
            <div>
                <h1 class="text-2xl font-bold text-gray-900">Add Expense</h1>
                <p class="text-gray-600">Record a new expense</p>
            </div>
            <a href="{{ url_for('main.dashboard') }}" class="text-gray-600 hover:text-gray-900">
                <i class="fas fa-times text-xl"></i>
            </a>
        </div>
    </div>

    <!-- Form -->
    <form method="POST" class="space-y-6" x-data="{ selectedCategory: '', amount: '', showPreview: false }">
        <!-- Amount -->
        <div class="card">
            <label for="amount" class="block text-sm font-medium text-gray-700 mb-2">
                <i class="fas fa-dollar-sign mr-2 text-green-500"></i>
                Amount
            </label>
            <div class="relative">
                <span class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500 text-lg">$</span>
                <input type="number" 
                       id="amount" 
                       name="amount" 
                       step="0.01" 
                       min="0.01"
                       x-model="amount"
                       @input="showPreview = amount > 0 && selectedCategory"
                       required
                       class="form-input pl-8 text-lg" 
                       placeholder="0.00">
            </div>
        </div>

        <!-- Category -->
        <div class="card">
            <label for="category_id" class="block text-sm font-medium text-gray-700 mb-3">
                <i class="fas fa-tags mr-2 text-blue-500"></i>
                Category
            </label>
            <div class="grid grid-cols-2 gap-3">
                {% for category in categories %}
                <div class="relative">
                    <input type="radio" 
                           id="category_{{ category.id }}" 
                           name="category_id" 
                           value="{{ category.id }}"
                           x-model="selectedCategory"
                           @change="showPreview = amount > 0 && selectedCategory"
                           class="sr-only">
                    <label for="category_{{ category.id }}" 
                           class="block p-4 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-gray-300 transition-colors"
                           :class="selectedCategory == '{{ category.id }}' ? 'border-blue-500 bg-blue-50' : ''">
                        <div class="text-center">
                            <div class="text-2xl mb-2">{{ category.icon }}</div>
                            <div class="text-sm font-medium text-gray-900">{{ category.name }}</div>
                        </div>
                    </label>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Description -->
        <div class="card">
            <label for="description" class="block text-sm font-medium text-gray-700 mb-2">
                <i class="fas fa-comment mr-2 text-purple-500"></i>
                Description <span class="text-gray-400">(optional)</span>
            </label>
            <input type="text" 
                   id="description" 
                   name="description" 
                   class="form-input" 
                   placeholder="What did you spend on?"
                   maxlength="255">
        </div>

        <!-- Date -->
        <div class="card">
            <label for="date" class="block text-sm font-medium text-gray-700 mb-2">
                <i class="fas fa-calendar mr-2 text-red-500"></i>
                Date
            </label>
            <input type="date" 
                   id="date" 
                   name="date" 
                   value="{{ today }}"
                   required
                   class="form-input">
        </div>

        <!-- Preview -->
        <div x-show="showPreview" x-transition class="card border-green-200 bg-green-50">
            <h3 class="text-lg font-semibold mb-2 text-green-800">
                <i class="fas fa-eye mr-2"></i>
                Preview
            </h3>
            <div class="flex items-center justify-between">
                <div>
                    <p class="font-medium text-green-900" x-text="document.getElementById('description').value || 'Expense'"></p>
                    <p class="text-sm text-green-700" x-text="'Category: ' + (selectedCategory ? categories.find(c => c.id == selectedCategory)?.name : '')"></p>
                </div>
                <div class="text-right">
                    <p class="text-2xl font-bold text-green-800" x-text="'$' + parseFloat(amount || 0).toFixed(2)"></p>
                </div>
            </div>
        </div>

        <!-- Submit Button -->
        <div class="card">
            <button type="submit" class="btn-primary w-full text-lg py-4">
                <i class="fas fa-plus mr-2"></i>
                Add Expense
            </button>
        </div>
    </form>
</div>

<script>
// Quick amount buttons
function setAmount(value) {
    document.getElementById('amount').value = value;
    document.getElementById('amount').dispatchEvent(new Event('input'));
}

// Add quick amount buttons
document.addEventListener('DOMContentLoaded', function() {
    const amountField = document.getElementById('amount');
    const quickAmounts = document.createElement('div');
    quickAmounts.className = 'flex gap-2 mt-2';
    quickAmounts.innerHTML = `
        <button type="button" onclick="setAmount('5.00')" class="px-3 py-1 bg-gray-100 text-gray-700 rounded text-sm hover:bg-gray-200">$5</button>
        <button type="button" onclick="setAmount('10.00')" class="px-3 py-1 bg-gray-100 text-gray-700 rounded text-sm hover:bg-gray-200">$10</button>
        <button type="button" onclick="setAmount('20.00')" class="px-3 py-1 bg-gray-100 text-gray-700 rounded text-sm hover:bg-gray-200">$20</button>
        <button type="button" onclick="setAmount('50.00')" class="px-3 py-1 bg-gray-100 text-gray-700 rounded text-sm hover:bg-gray-200">$50</button>
    `;
    amountField.parentElement.parentElement.appendChild(quickAmounts);

    // Focus on amount field
    amountField.focus();

    // Store categories for Alpine.js
    window.categories = {{ categories|tojson }};
});

// Form validation
document.querySelector('form').addEventListener('submit', function(e) {
    const amount = parseFloat(document.getElementById('amount').value);
    if (amount <= 0) {
        e.preventDefault();
        alert('Please enter a valid amount greater than 0');
        return;
    }

    const category = document.querySelector('input[name="category_id"]:checked');
    if (!category) {
        e.preventDefault();
        alert('Please select a category');
        return;
    }

    // Show loading state
    const submitBtn = e.target.querySelector('button[type="submit"]');
    submitBtn.disabled = true;
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Adding Expense...';
});
</script>
{% endblock %}